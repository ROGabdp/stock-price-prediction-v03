# 技術規劃執行摘要

**專案**: 股價漲跌機率預測系統  
**執行日期**: 2025-11-13  
**狀態**: ✅ 完成

---

## 一、已交付文件清單

### 核心規劃文件

| 檔案路徑 | 檔案大小 | 說明 | 狀態 |
|---------|---------|------|------|
| `specs/001-stock-price-prediction/research.md` | 24 KB | 技術研究與決策 | ✅ 完成 |
| `specs/001-stock-price-prediction/data-model.md` | 21 KB | 資料模型設計 | ✅ 完成 |
| `specs/001-stock-price-prediction/contracts/api.yaml` | 7.2 KB | API 合約（OpenAPI 3.0） | ✅ 完成 |
| `specs/001-stock-price-prediction/quickstart.md` | 7.7 KB | 快速入門指南 | ✅ 完成 |
| `specs/001-stock-price-prediction/plan.md` | 11 KB | 實作計畫（已更新） | ✅ 完成 |

**總計**: 5 個檔案，約 71 KB 文件內容

---

## 二、關鍵技術決策摘要

### 後端技術堆疊

| 類別 | 選擇 | 版本 | 選擇理由 |
|------|------|------|----------|
| **Web 框架** | Flask | 3.0.0 | 輕量、易上手、文件豐富，符合 MVP 需求 |
| **ML 框架** | TensorFlow + Keras | 2.15.0 | API 簡潔、適合 LSTM、生態系統完整 |
| **超參數調整** | Keras Tuner | 1.4.6 | 與 Keras 無縫整合、配置簡單 |
| **資料處理** | pandas | 2.1.4 | Python 資料處理標準工具 |
| **模型儲存** | TensorFlow SavedModel | - | 官方推薦格式、跨平台 |

### 前端技術堆疊

| 類別 | 選擇 | 版本 | 選擇理由 |
|------|------|------|----------|
| **框架** | 原生 JavaScript | ES6+ | 避免過度設計、零配置、快速開發 |
| **圖表函式庫** | Chart.js | 4.4.0 (CDN) | 簡單易用、輕量、互動功能完整 |
| **HTTP 客戶端** | Fetch API | 原生 | 瀏覽器內建、支援 async/await |
| **日期選擇器** | HTML5 `<input type="date">` | 原生 | 零依賴、瀏覽器原生支援 |

### 架構與儲存

| 類別 | 選擇 | 選擇理由 |
|------|------|----------|
| **專案架構** | 前後端分離 | 職責清晰、可平行開發、部署彈性 |
| **通訊協定** | RESTful API (JSON) | 簡單直觀、無狀態、業界標準 |
| **資料儲存** | 檔案系統 + JSON 元資料 | 避免資料庫複雜性、易於備份、符合規模 |
| **API 命名** | camelCase | 符合憲章要求、業界標準 |

---

## 三、資料模型設計

### 核心實體（8 個）

1. **DataFile** - CSV 歷史股價資料檔案
2. **HistoricalStockData** - CSV 內的股價記錄
3. **PredictionModel** - 訓練好的 LSTM 模型
4. **PredictionRequest** - 預測請求（暫態）
5. **PredictionResult** - 預測結果（暫態）
6. **TrainingTask** - 訓練任務執行記錄
7. **HyperparameterConfiguration** - 超參數配置（嵌入模型）
8. **CSVColumnDefinition** - CSV 格式規範

### 儲存方案

```
backend/
├── data/
│   ├── uploaded/          # CSV 檔案
│   └── metadata.json      # 集中式元資料
├── models/                # .keras 模型檔案
└── logs/                  # 訓練日誌
```

---

## 四、API 設計

### 端點總覽（11 個）

| 分類 | 端點 | 方法 | 功能 |
|------|------|------|------|
| **資料管理** | `/api/data/upload` | POST | 上傳 CSV 檔案 |
| | `/api/data/files` | GET | 取得資料檔案清單 |
| | `/api/data/files/{fileId}` | GET | 取得檔案詳情 |
| | `/api/data/files/{fileId}` | DELETE | 刪除資料檔案 |
| **模型訓練** | `/api/models/train` | POST | 啟動模型訓練 |
| | `/api/models/training/tasks/{taskId}` | GET | 查詢訓練進度 |
| **模型管理** | `/api/models` | GET | 取得模型清單 |
| | `/api/models/{modelId}` | GET | 取得模型詳情 |
| | `/api/models/{modelId}` | DELETE | 刪除模型 |
| **預測執行** | `/api/predict` | POST | 執行股價預測 |
| | `/api/predict/compare` | POST | 比較多個模型 |

**命名慣例**: 所有欄位使用 camelCase  
**錯誤訊息**: 所有錯誤訊息使用正體中文

---

## 五、專案結構

### 目錄結構

```
stock-price-prediction-v03/
├── backend/              # 後端專案
│   ├── src/
│   │   ├── api/         # API 路由層（4 個檔案）
│   │   ├── models/      # 資料模型層（4 個檔案）
│   │   ├── services/    # 業務邏輯層（4 個檔案）
│   │   ├── ml/          # ML 模組（4 個檔案）
│   │   └── utils/       # 工具函式（3 個檔案）
│   ├── data/            # 資料儲存
│   ├── models/          # 模型儲存
│   └── requirements.txt
├── frontend/            # 前端專案
│   ├── pages/           # HTML 頁面（4 個）
│   ├── css/             # 樣式（2 個）
│   └── js/              # JavaScript 模組（6 個）
└── specs/               # 規格文件
```

**設計理念**:
- **前後端分離**: 透過 RESTful API 通訊
- **後端分層**: API → Services → Models → ML
- **前端模組化**: 按功能拆分頁面與 JS 模組

---

## 六、憲章合規性

### 檢查結果

| 憲章原則 | 檢查結果 | 說明 |
|----------|---------|------|
| I. 正體中文優先 | ✅ 符合 | 所有文件、註解、UI 文字、錯誤訊息使用正體中文 |
| II. 規格驅動開發 | ✅ 符合 | 所有決策基於 spec.md |
| III. 高品質可測試的 MVP | ✅ 符合 | 專注 P1 故事（訓練與預測） |
| IV. 嚴格禁止過度設計 | ✅ 符合 | 選擇最簡單方案（原生 JS、檔案系統、Flask） |
| V. Pythonic 與 PEP 8 | ✅ 符合 | 使用 black + flake8 |
| VI. Idiomatic JavaScript | ✅ 符合 | 使用 ES6+、ESLint + Prettier |
| VII. 簡潔務實 | ✅ 符合 | 優先使用成熟函式庫 |

**結論**: 所有憲章原則皆已通過，無違規項目。

---

## 七、需要使用者確認的技術選擇

### 1. 前端框架選擇

**決策**: 使用原生 JavaScript（不使用 Vue.js/React）

**理由**: 
- 專案 UI 互動簡單（表單 + 圖表）
- 避免框架學習曲線與打包工具複雜性
- 符合「嚴格禁止過度設計」原則

**替代方案**: 若使用者偏好使用 Vue.js，可在後續調整

---

### 2. 資料儲存方案

**決策**: 使用檔案系統（不使用資料庫）

**理由**:
- 預估規模小（50 個模型、100 個檔案）
- 避免資料庫安裝與配置複雜性
- 易於備份（直接複製資料夾）

**替代方案**: 若未來資料量超過 100 個模型，可遷移至 SQLite

---

### 3. 超參數調整策略

**決策**: 使用 Keras Tuner 自動搜索

**理由**:
- 自動找到最佳超參數，提升模型準確率
- 與 Keras 無縫整合

**權衡**: 訓練時間較長（約 3-10 分鐘），但準確率提升

---

## 八、預估開發時程（P1 故事為主）

### Phase 1: 基礎架構與資料管理（3-5 天）

- [ ] 建立專案目錄結構
- [ ] 設定 Flask 後端與前端開發伺服器
- [ ] 實作資料上傳 API（FR-017, FR-018）
- [ ] 實作 CSV 驗證邏輯（FR-019, FR-021）
- [ ] 實作資料清單 API（FR-016）
- [ ] 前端：資料管理頁面（上傳、列表、刪除）

### Phase 2: 模型訓練功能（5-7 天）

- [ ] 實作 LSTM 模型建構器（FR-003）
- [ ] 整合 Keras Tuner 超參數調整（FR-004）
- [ ] 實作訓練服務（啟動訓練、監控進度）（FR-005）
- [ ] 實作訓練任務 API（POST /api/models/train）（FR-001）
- [ ] 實作模型儲存與元資料管理（FR-007）
- [ ] 前端：模型訓練頁面（表單、進度顯示、結果顯示）（FR-006）

### Phase 3: 預測執行功能（5-7 天）

- [ ] 實作模型載入與預測邏輯（FR-012）
- [ ] 實作預測請求驗證（FR-010, FR-011）
- [ ] 實作預測 API（POST /api/predict）（FR-009）
- [ ] 實作歷史資料與預測結果整合（FR-013）
- [ ] 前端：預測執行頁面（表單、日期選擇器）
- [ ] 前端：Chart.js 圖表視覺化（FR-014, FR-015）

### Phase 4: 測試與優化（2-3 天）

- [ ] 端對端測試（上傳 → 訓練 → 預測）
- [ ] 錯誤處理與驗證訊息優化
- [ ] 效能測試（大檔案上傳、圖表渲染）
- [ ] 文件完善（README、API 文件）

**總計**: 15-22 天（約 3-4.5 週）

**P2 故事**（資料管理進階功能）：+3-5 天  
**P3 故事**（模型比較）：+3-5 天

---

## 九、風險與緩解

### 高風險項目

| 風險 | 影響 | 緩解策略 |
|------|------|----------|
| 模型訓練時間過長 | 使用者體驗差 | 使用 Hyperband 早停、顯示進度條、限制搜索空間 |
| 記憶體不足 | 訓練失敗 | 使用批次訓練、監控記憶體、適當設定 batch_size |
| CSV 格式多樣化 | 資料無法載入 | 詳細錯誤訊息、提供範例檔案 |

---

## 十、下一步行動

1. **審查規劃文件**: 確認技術選型與架構設計
2. **確認技術選擇**: 特別是前端框架與儲存方案
3. **執行 `/speckit.tasks`**: 產生詳細任務清單（tasks.md）
4. **開始實作**: 依據 tasks.md 執行 P1 故事

---

**文件版本**: 1.0.0  
**產生時間**: 2025-11-13  
**產生工具**: Claude Code (Sonnet 4.5)
